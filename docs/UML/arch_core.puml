@startuml ArchCore
title mexOS Microkernel: Arch & Core

skinparam linetype ortho
skinparam package {
    BackgroundColor<<Arch>> LightBlue
    BackgroundColor<<Core>> LightGreen
    BorderColor Black
    Shadowing false
}

' =========================
' ARCH (i686)
' =========================
package "Arch (i686)" <<Arch>> {
    [boot.s]
    [gdt_asm.s]
    [gdt.c]
    [gdt.h]
    [idt_asm.s]
    [idt.c]
    [idt.h]
    [arch.h]
}

' =========================
' CORE SYSTEM
' =========================
package "Core" <<Core>> {
    [kernel.c]
    [kernel.h]
    [elf.c]
    [elf.h]
    [initrd.h]

    [syscall.c]
    [syscall.h]

    [log.c]
    [log.h]

    [string.c]
    [string.h]

    [console.c]
    [console.h]

    [sysmon.c]
    [sysmon.h]
}

' =========================
' UI + TUI
' =========================
package "UI" <<Core>> {
    [basic.c]
    [basic.h]
    [shell.c]
    [shell.h]
    [editor.c]
    [editor.h]
    [tui.c]
    [tui.h]
    [vterm.c]
    [vterm.h]
}

' =========================
' DRIVER LAYER (Core)
' =========================
package "Drivers" <<Core>> {

    package "Input" {
        [keyboard.c]
        [keyboard.h]
    }

    package "Char" {
        [serial.c]
        [serial.h]
        [rtc.c]
        [rtc.h]
    }

    package "Bus" {
        [pci.c]
        [pci.h]
        [acpi.c]
        [acpi.h]
    }

    package "Video" {
        [vesa.c]
        [vesa.h]
    }

    package "Storage" {
        [ata.c]
        [ata.h]
    }
}

' =========================
' FS
' =========================
package "Filesystem" <<Core>> {
    [fs.c]
    [fs.h]
    [vfs.h]
}

' Dependencies
[boot.s] --> [gdt.c]
[gdt.c] --> [idt.c]
[idt.c] --> [kernel.c]

[console.c] --> [console.h]
[fs.c] --> [fs.h]
[keyboard.c] --> [keyboard.h]
[log.c] --> [log.h]
[shell.c] --> [shell.h]
[syscall.c] --> [syscall.h]
[sysmon.c] --> [sysmon.h]

' Legend
legend right
| Color | Layer |
| LightBlue | Arch |
| LightGreen | Core |
endlegend

@enduml
